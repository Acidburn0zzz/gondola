# Config format: HOCON
# https://github.com/typesafehub/config/blob/master/HOCON.md

gondola {
  hosts = [
    { hostId = "host1", siteId = "gq1", hostname = "localhost", port = "2181", appScheme = "http", appPort = "8080"},
    { hostId = "host2", siteId = "bf1", hostname = "localhost", port = "2182", appScheme = "http", appPort = "8081"},
    { hostId = "host3", siteId = "bf2", hostname = "localhost", port = "2183", appScheme = "http", appPort = "8082"},
    { hostId = "host4", siteId = "gq1", hostname = "localhost", port = "2184", appScheme = "http", appPort = "8083"},
    { hostId = "host5", siteId = "bf1", hostname = "localhost", port = "2185", appScheme = "http", appPort = "8084"},
    { hostId = "host6", siteId = "bf2", hostname = "localhost", port = "2186", appScheme = "http", appPort = "8085"},
  ]
  shards = [
    {
      shardId = "shard1", bucketMap = "0-99,200",
      hosts = [
        {hostId: "host1", memberId: "81"},
        {hostId: "host2", memberId: "82"},
        {hostId: "host3", memberId: "83"}
      ],
    },
    {
      shardId = "shard2", bucketMap = "100-199",
      hosts = [
        {hostId: "host6", memberId: "86"},
        {hostId: "host5", memberId: "85"},
        {hostId: "host4", memberId: "84"},
      ],
    }
  ],
  sites = [
    {
      siteId = "gq1",
      storage_mysql {
        url = "jdbc:mysql://db1.gq1.yahoo.com/awesomeProject"
        ssh_user = "db_backup", ssh_passphrase = "secret", ssh_private_key = "~/.ssh/identity"
      }
    },
    {
      siteId = "ne1",
      storage_mysql {
        url = "jdbc:mysql://db1.ne1.yahoo.com/awesomeProject"
      }
    },
    {
      siteId = "bf1",
      storage_mysql {
        url = "jdbc:mysql://db1.bf1.yahoo.com/awesomeProject"
      }
    },
  ]
}

##################### raft

raft {
  # The leader sends a heartbeat at this interval (ms)
  heartbeat_period = 250

  # A follower will become a candidate if it has not received a heartbeat within this period (ms)
  election_timeout = 3000

  # A leader will become a candidate if it has not heard from floor(N/2) followers,
  # where N is the number of nodes in the cluster (ms)
  leader_timeout = 10000

  # A candidate will send out a request vote within this period.
  # The actual value is a random value in [0, this value]. (ms)
  request_vote_period = 300

  command_max_size = 1000

  # Write empty command after leader election for force any previous commands to be committed. Dynamic.
  write_empty_command_after_election = true
}

##################### gondola
gondola {
  config_reload_period = 10000
  command_pool_warn_threshold = 1000
  command_queue_size = 200
  message_pool_warn_threshold = 1000
  incoming_queue_size = 100
  wait_queue_throttle_size = 100
  batching = true
  file_lock_dir = "/tmp"
  write_empty_command_after_election = true

  tracing {
    summary_period = 5000
    raft_messages = false
    raft_heartbeats = true
    command = false
    storage = false
    network = false
    message_leak = false
  }
}

##################### storage

storage {
  impl = storage.h2
  save_queue_workers = 5

  h2 {
    class = com.yahoo.gondola.impl.H2dbStorage
    url = "jdbc:h2:/tmp/gondola-db-$hostId"
    user = sa
    password = ""
    port = 9092
    type = h2
  }
}

##################### gondola command

tracing {
  cli {
    agent = false
    command = false
  }

  router = true
}

network {
  impl = network.socket

  # A channel will be discarded if after sending a message and there is no response for this period. (ms)
  channel_inactivity_timeout = 10000

  socket {
    class = com.yahoo.gondola.impl.SocketNetwork

    # When a connection to a remote member is not valid, this is the period at which a reconnect is attempted. (ms)
    create_socket_retry_period = 1000

    # Timeouts for socket connects
    connect_timeout = 60000
  }

  memory {
    class = com.yahoo.gondola.impl.MemoryNetwork
  }
}


##################### clock
clock {
  impl = clock.system

  system {
    class = com.yahoo.gondola.impl.SystemClock
  }
}

